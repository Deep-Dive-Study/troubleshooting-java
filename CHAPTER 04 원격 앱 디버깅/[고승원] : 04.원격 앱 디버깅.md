# chapter04 원격 앱 디버깅

디버깅을 할 때 그것이 일어난 환경에 직접 접속해보지 않으면 조사하기 까다로울 때가 있다.

![Uploading image.png…]()

이럴땐 원격 디버깅을 통해 조사할 수 있다.

# 4.1 원격 디버깅이란?

원격 디버깅이란 그저 디버깅 기술을 외부 환경에 적용하는 것에 불과하다.

앱을 개발할 때 적용되는 환경

- 개발 환경
- 사용자 인수 테스트 환경
- 프로덕션 환경

환경마다 앱이 다르게 동작하는 경우

- 앱 환경에서 사용되는 데이터가 다르다. 접속하는 모듈도 다르다 (DB 등)
- 앱이 설치된 OS가 다르다.
- 배포 체계가 다르다.
- 퍼미션 설정이 다르다.
- 리소스가 다르다. (CPU, 메모리 등)
- 엔드 포인트가 다른 경우

원격 디버깅을 하려면 에이전트라는 소프트웨어를 앱에 부착해야 한다. 하지만 **“어떠한 경우에도 프로덕션 환경에서 원격 디버깅을 사용해서는 안된다.”** 이유는 다음과 같다.

- 에이전트 떄문에 앱 실행 속도가 느려질 수 있다. 즉, 예기치 않은 성능 문제가 발생할 수 있다.
- 에이전트와 통신 하려면 특정 포트를 오픈해야 하는데, 보안 취약 요소가 발생할 수 있다.
- 앱의 어떤 부분을 다른 곳에서 동시 사용 중일 경우, 해당 코드를 디버깅하면 전체적인 기능에 간섭을 일으킨다.
- 디버깅하다 앱이 무한정 차단돼서 프로세스를 재시작해야 한다.

# 4.2 원격 환경에서 조사하기

## 4.2.1 시나리오

1. 대규모 재고 관리 앱을 유지보수 중이다.
2. 새로운 기능을 구현했는데, 개발 환경, UAT 환경에 앱을 성공했다. 최종 검증을 하는데 문제가 발생했다.
3. 찾아보니, FE 문제는 아니고 엔드포인트에 문제가 있는 것 같다.
    1. 200 응답이 오지만, 데이터가 리턴되지 않는다.
    

## 4.2.2 원격 환경의 문제 조사하기

원격 디버깅할 앱은 커맨드 라인에서 java로 앱을 시작할 때 `-agentlib:jdwp` 매개변수를 추가하여 agent와 연결해야 한다. 

이때 디버거 도구룰 연결할 포트를 지정해야 하는데, 추후에 디버거는 해당 포트에 접속한다.

![image](https://github.com/Deep-Dive-Study/troubleshooting-java/assets/85796588/7ac94b6f-140f-4c53-ac28-186e11521d27)

- transport=dt_socket : 디버거 도구가 디버거 에이전트와 통신하는 방식을 지정한 것이다. (TCP/IP)
- server=y : 앱 실행에 부착한 에이전트를 서버로 사용한다는 의미이다.
- suspend=n : 디버거 도구가 접속하길 기다리지 않는다는 의미. y이면 디버거가 접속할 때 까지 실행하지 않는다.
- address=*:5005 : 디버거 도구가 에이전트와 5005 포트로 통신하도록 한다.

실무에서 원격 디버깅을 하려면 사전에 통신 가능 여부를 미리 확인하자.

IntelliJ에서 원격 디버거로 접속하는 방법

1. 실행 구성을 새로 추가한다.
2. 디버거 에이전트의 원격지 주소를 설정한다.
3. 앱 디버깅을 시작한다.

![image](https://github.com/Deep-Dive-Study/troubleshooting-java/assets/85796588/c1c6f93a-61ab-483d-9772-4cff548cb7d1)

![image](https://github.com/Deep-Dive-Study/troubleshooting-java/assets/85796588/a19f4867-8e74-4750-8a47-3adeafd40d4b)

내가 갖고 있는 소스 코드와 디버거를 접속시킨 원격 앱의 컴파일된 소스의 버전이 다름을 유의하자.

# 요약

- 특정 환경에서 발생하는 문제는 원격 디버깅을 하자 (운영 환경은 안된다)
- 에이전트를 부착해 원격 디버거로 접속할 수 있다.
- 원격 환경의 코드 버전과, 로컬 버전이 상이한지 유의하라.
