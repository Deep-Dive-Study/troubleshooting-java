# Chapter 5 - 로그를 활용하여 앱 동작 감시하기
- 주요 내용
  - 로그를 활용하여 앱 동작 이해하기
  - 로깅 기능 올바르게 사용하기
  - 로그 사용시 주의 사항
  
- 참고하면 좋은 자료
  - [[10분 테코톡] ☂️ 검프의 Logging(로깅)](https://youtu.be/1MD5xbwznlI?si=c4rWVgpyfCEN7k2y)
  - [옵저버빌리티: 로그라고해서 다 같은 로그가 아니다](https://netmarble.engineering/observability-logging-b/)
  - 로그에 대해서는 아직 고민이 많음. 좋은 자료가 있으면 공유바람.

- **로그 메시지를 보면 앱이 실행 중에 무슨 일이 있어났는지 알 수 있음**
 - 말그대로 활동 기록
 - 이를 바탕으로 회고, 분석, 등에 활용 가능함

  ![CleanShot 2024-05-27 at 23 16 52](https://github.com/Deep-Dive-Study/troubleshooting-java/assets/99165624/f0b4ab89-43ed-4617-8dd5-f04d15b21c0e)

- **`로그를 사용하면 좋은 상황`**
  - 이미 발생한 단일 이벤트 또는 이벤트 타임라인을 조사해야하는 경우 (일정 기간 단위)
  - 간섭이 일어나면 앱 동작이 바뀌는 문제를 조사해야하는 경우 (실행 영향 X)
  - 오랜 시간에 걸친 앱의 동작을 이해하는 경우 (전체 맥락)
  - 즉각적인 주의가 필요한 중대 이벤트를 알려줘야 하는 경우 (실시간)

- **개발자라면 문제를 조사할 때는 무엇보다 로그를 가장 먼저 확인해야함**
 - 어디서 부터 조사를 시작해야 할지 정확하게 진단할 수 있음

   ![CleanShot 2024-05-27 at 23 20 18](https://github.com/Deep-Dive-Study/troubleshooting-java/assets/99165624/fbb8c375-e0d0-4b02-ab50-746c8f91318c)

## 5.1 로그를 이용하여 조사하기
- **`로그의 특징`**
  - **`주어진 시간에 특정 코드의 실행을 시각화하는 능력`**
    - 디버거는 현재에 초점, 로그는 과거 특정 기간에 초점

      ![CleanShot 2024-05-27 at 23 22 42](https://github.com/Deep-Dive-Study/troubleshooting-java/assets/99165624/103ae5bd-cef9-46e4-b15a-400f15ea2b38)

    - 로그를 사용할 때에는 항상 앱이 실행되는 시스템의 표준 시간대를 체크해야함

  - **`로그는 문제가 발생한 이후 근본 원인을 찾기에 유용함`**
    - 보통 문제에 대한 조사를 어디서 부터 시작할지를 로그를 보고나서 결정함 → 상황 파악
    - 이후 문제에 대한 보다 상세한 조사를 위해 여러 방법(디버거, 프로파일러, 등)을 적절한 상황에 맞게 선택

      ![CleanShot 2024-05-27 at 23 26 39](https://github.com/Deep-Dive-Study/troubleshooting-java/assets/99165624/58d45058-17e5-4495-bda6-eb0054ccc583)

    - 다만, 로그에 기록된 문제가 원인이 아닌 결과일 수 있다는 점을 기억해야함

      ![CleanShot 2024-05-27 at 23 27 17](https://github.com/Deep-Dive-Study/troubleshooting-java/assets/99165624/e812267e-33d2-4ba5-99d2-ccf5cc30331f)

  - `예외 스택 트레이스를 로깅하여 특정 메서드를 어디에서 호출했는지 알아낼 수 있음`
  - `멀티스레드 아키텍처에서 커맨드의 실행 시간 측정`
  - `멀티스레드 아키텍처에서 커맨드 실행 문제 조사`
    - 로그는 실행에 간섭 없이(특히, 멀티스레드 환경) 로그를 남길 수 있어 문제 파악에 용이함
    - 각 스레드별 이름을 부여할 수 있고, Trace 기능을 통해 실행을 추적 가능함  

## 5.2 로깅을 구현하는 방법
- 실제 구현에 대해서는 다들 알고 있을 거라고 생각함. 만약 모른다면 다른 상세한 자료를 참고하여 실제로 해보길 권장함.
- 여기에는 로그를 이루는 중요 개념만 다룰 것임
  
- **`로깅 레벨(심각도)`**
  - 조사 중요도에 따라 로그 메시지를 분류한 것

    ![CleanShot 2024-05-27 at 23 41 02](https://github.com/Deep-Dive-Study/troubleshooting-java/assets/99165624/49c04181-8c46-4858-b38f-0c4f7fbc877e)

  - `주요 레벨`
    - `Error(에러)`: 아주 중대한 문제가 발생한 것으로, 이런 이벤트는 반드시 기록해야 한다. 보통 앱에서 처리되지 않은 예외(unhandled exception)는 에러로 기록된다.
    - `Warn(경고)`: 잠재적으로 에러일 수 있으나 앱이 처리한 이벤트다. 예를 들어 타사 시스템과의 데이터 연동이 처음에는 실패했지만 두 번째 시도에는 성공했다면 경고로 기록한다.
    - `Info(정보)`: '상시(common) 로그 메시지. 대부분의 상황에서 앱이 어떻게 작동하고 있는지 이해하는 데 유용한, 주요한 앱 실행 이벤트를 나타낸다.
    - `Debug(디버그)`: Info 메시지만으로 불충분한 경우에 한하여 매우 세분화된(fine-grained) 정보를 남긴다. 

- **`로깅을 수행하는 구현체`**
  - `로거(1ogger)` : 어떤 메시지를 어느 어펜더에 기록하는가?
  - `어펜더(appender)` : 로그 메시지를 어디에 기록하는가?
  - `포매터(formatter)` : 메시지를 어떻게 출력하는가?

    ![CleanShot 2024-05-27 at 23 51 16](https://github.com/Deep-Dive-Study/troubleshooting-java/assets/99165624/18ce1ec5-46a9-42c1-9a6b-dd17c7e557c1)

    ![CleanShot 2024-05-27 at 23 51 46](https://github.com/Deep-Dive-Study/troubleshooting-java/assets/99165624/dea9624b-17bf-4fa5-befc-14927915347b)

- 아직 이해안되는 부분
  - 책에서 나온 status 값의 의미
  - actuator에서 제공하는 기능 외에 로그 레벨을 운영 중에 변경할 수 있는지? 

### 5.2.3 로깅 때문에 발생하는 문제와 예방 조치
- 로깅 역시 올바르게 사용하지 않으면 문제가 발생할 수 있음

- **`주의점 및 발생 가능한 문제`**
  - `보안 및 프라이버시 문제`: 로그 메시지에 개인정보와 같은 민감 정보가 노출될 수 있음
  - `성능 문제`: 지나치게 많은 로그 메시지는 리소를 많이 소모할 가능성이 있고, 성능에 악영향을 줄 수 있음
  - `유지보수 문제`: 로그를 남기는 커맨드 때문에 소스 코드의 가독성이 떨어질 가능성이 있음 

    ![CleanShot 2024-05-27 at 23 57 03](https://github.com/Deep-Dive-Study/troubleshooting-java/assets/99165624/586c7421-93d6-47f0-8399-cd44771a3f85)

## 5.3 로그와 원격 디버깅
- **`로그와 원격 디버깅의 관계는 상호 보완적인 관계임`**
  - 각각 사용해야 하는 상황이 다르고, 오히려 같이 사용했을 때 시너지가 남
  - **`일반적인 시나리오는 로그를 통해 디버깅해야하는 지점을 찾고, 원격 디버깅을 통해 보다 상세히 파악하는 것`**

  ![CleanShot 2024-05-27 at 23 05 10](https://github.com/Deep-Dive-Study/troubleshooting-java/assets/99165624/d18142d4-326d-4bb5-b6e0-0b440ed2967d)

## 요약
  - 로그는 어디서 부터 조사를 시작해야할지 힌트를 얻을 수 있음. 따라서, 일단 문제가 발생하면 로그를 확인해야함 
  - 로그는 시간과 이벤트를 이해할 수 있도록 문맥을 제공하는 힌트(연관 데이터)를 제공하는 것이 중요
  - 로그를 너무 많이 저장하면 오히려 성능 저하의 문제가 발생할 수 있음
  - 로그에 기록된 예외(문제)가 항상 원인은 아닐 수 있음. 어쩌면 문제의 결과일 수 있음. 섣불리 속단하지 말고 근본 원인을 조사해야함
  - 민감 정보는 절대 로그에 남겨서는 안됨

  ![CleanShot 2024-05-27 at 23 08 36](https://github.com/Deep-Dive-Study/troubleshooting-java/assets/99165624/ad46607c-4e02-4089-b326-0a92fe61eb7e)

## 내 생각
  - 로그에서 중요한 것은 무엇을 얼만큼(어떤 레벨로) 기록할 것이냐임
  - 우리가 바라는 건 아래와 같을 것
    - 문제가 발생했을 때 빠르게 문제를 이해할 수 있을만큼 충분한 정보를 제공하고 있는지?
    - 로그를 통한 비즈니스 인사이트 창출(통계 정보)아 가능한지? 
  - 아직 회사의 전반적인 로그 관리 시스템이 미완성이라고 생각함
    - 이를 어떻게 관리해야할지 모르겠음,, 
